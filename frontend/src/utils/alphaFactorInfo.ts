/**
 * Alphaå› å­ä¿¡æ¯å®šä¹‰
 * 
 * æä¾›Alphaå› å­çš„åˆ†ç±»ã€æè¿°å’Œè¯´æ˜
 */

export interface AlphaFactorInfo {
  name: string;
  category: string;
  description: string;
  formula?: string;
  period?: number;
}

// Alphaå› å­åˆ†ç±»ä¿¡æ¯
export const ALPHA_FACTOR_CATEGORIES = {
  MOMENTUM: {
    name: 'åŠ¨é‡å› å­',
    description: 'è¡¡é‡ä»·æ ¼åŠ¨é‡ã€è¶‹åŠ¿å’Œå˜åŒ–ç‡ï¼ˆAlpha #1-60ï¼‰',
    icon: 'ğŸ“ˆ',
  },
  MEAN_REVERSION: {
    name: 'å‡å€¼å›å½’å› å­',
    description: 'è¯†åˆ«ä»·æ ¼åç¦»å‡å€¼çš„å›å½’æœºä¼šï¼ˆAlpha #61-100ï¼‰',
    icon: 'ğŸ”„',
  },
  VOLATILITY: {
    name: 'æ³¢åŠ¨ç‡å› å­',
    description: 'è¡¡é‡ä»·æ ¼å’Œæˆäº¤é‡çš„æ³¢åŠ¨ç¨‹åº¦ï¼ˆAlpha #101-140ï¼‰',
    icon: 'ğŸ“‰',
  },
  VOLUME: {
    name: 'æˆäº¤é‡å› å­',
    description: 'åˆ†ææˆäº¤é‡å˜åŒ–å’Œé‡ä»·å…³ç³»ï¼ˆAlpha #141-158ï¼‰',
    icon: 'ğŸ“¦',
  },
  RESI: {
    name: 'ä»·æ ¼æ”¶ç›Šç‡',
    description: 'è¡¡é‡ä¸åŒæ—¶é—´çª—å£çš„ä»·æ ¼å˜åŒ–è¶‹åŠ¿å’ŒåŠ¨é‡',
    icon: 'ğŸ“ˆ',
  },
  MA: {
    name: 'ç§»åŠ¨å¹³å‡',
    description: 'å¹³æ»‘ä»·æ ¼æ³¢åŠ¨ï¼Œè¯†åˆ«ä»·æ ¼è¶‹åŠ¿',
    icon: 'ğŸ“Š',
  },
  STD: {
    name: 'ä»·æ ¼æ³¢åŠ¨ç‡',
    description: 'è¡¡é‡ä»·æ ¼æ³¢åŠ¨ç¨‹åº¦ï¼Œç”¨äºé£é™©è¯„ä¼°',
    icon: 'ğŸ“‰',
  },
  VSTD: {
    name: 'æˆäº¤é‡æ³¢åŠ¨ç‡',
    description: 'è¡¡é‡æˆäº¤é‡æ³¢åŠ¨ï¼Œè¯†åˆ«å¼‚å¸¸äº¤æ˜“',
    icon: 'ğŸ“¦',
  },
  CORR: {
    name: 'é‡ä»·ç›¸å…³æ€§',
    description: 'ä»·æ ¼ä¸æˆäº¤é‡çš„ç›¸å…³æ€§ï¼Œåˆ¤æ–­å¸‚åœºæƒ…ç»ª',
    icon: 'ğŸ”—',
  },
  MAX: {
    name: 'æœ€é«˜ä»·',
    description: 'è¯†åˆ«é˜»åŠ›ä½å’Œçªç ´ä¿¡å·',
    icon: 'â¬†ï¸',
  },
  MIN: {
    name: 'æœ€ä½ä»·',
    description: 'è¯†åˆ«æ”¯æ’‘ä½å’Œä¸‹è·Œä¿¡å·',
    icon: 'â¬‡ï¸',
  },
  QTLU: {
    name: 'åˆ†ä½æ•°æ¯”ç‡',
    description: 'è¡¡é‡ä»·æ ¼åˆ†å¸ƒçš„ç¦»æ•£ç¨‹åº¦',
    icon: 'ğŸ“',
  },
  OTHER: {
    name: 'å…¶ä»–Alphaå› å­',
    description: 'å…¶ä»–ç±»å‹çš„Alphaå› å­',
    icon: 'ğŸ”¢',
  },
};

/**
 * Alpha158å› å­ç¼–å·åˆ°å®é™…åç§°çš„æ˜ å°„è¡¨
 * åŸºäºQlibæ ‡å‡†Alpha158å› å­å®šä¹‰
 */
const ALPHA158_FACTOR_NAMES: Record<number, string> = {
  // åŠ¨é‡å› å­ (1-60)
  1: 'ä»·æ ¼æ”¶ç›Šç‡(1æ—¥)', 2: 'ä»·æ ¼æ”¶ç›Šç‡(2æ—¥)', 3: 'ä»·æ ¼æ”¶ç›Šç‡(3æ—¥)', 4: 'ä»·æ ¼æ”¶ç›Šç‡(4æ—¥)', 5: 'ä»·æ ¼æ”¶ç›Šç‡(5æ—¥)',
  6: 'ä»·æ ¼æ”¶ç›Šç‡(6æ—¥)', 7: 'ä»·æ ¼æ”¶ç›Šç‡(7æ—¥)', 8: 'ä»·æ ¼æ”¶ç›Šç‡(8æ—¥)', 9: 'ä»·æ ¼æ”¶ç›Šç‡(9æ—¥)', 10: 'ä»·æ ¼æ”¶ç›Šç‡(10æ—¥)',
  11: 'ä»·æ ¼æ”¶ç›Šç‡(11æ—¥)', 12: 'ä»·æ ¼æ”¶ç›Šç‡(12æ—¥)', 13: 'ä»·æ ¼æ”¶ç›Šç‡(13æ—¥)', 14: 'ä»·æ ¼æ”¶ç›Šç‡(14æ—¥)', 15: 'ä»·æ ¼æ”¶ç›Šç‡(15æ—¥)',
  16: 'ä»·æ ¼æ”¶ç›Šç‡(16æ—¥)', 17: 'ä»·æ ¼æ”¶ç›Šç‡(17æ—¥)', 18: 'ä»·æ ¼æ”¶ç›Šç‡(18æ—¥)', 19: 'ä»·æ ¼æ”¶ç›Šç‡(19æ—¥)', 20: 'ä»·æ ¼æ”¶ç›Šç‡(20æ—¥)',
  21: 'ä»·æ ¼åŠ¨é‡(5æ—¥)', 22: 'ä»·æ ¼åŠ¨é‡(10æ—¥)', 23: 'ä»·æ ¼åŠ¨é‡(15æ—¥)', 24: 'ä»·æ ¼åŠ¨é‡(20æ—¥)', 25: 'ä»·æ ¼åŠ¨é‡(30æ—¥)',
  26: 'ç›¸å¯¹å¼ºåº¦(5æ—¥)', 27: 'ç›¸å¯¹å¼ºåº¦(10æ—¥)', 28: 'ç›¸å¯¹å¼ºåº¦(20æ—¥)', 29: 'ç›¸å¯¹å¼ºåº¦(30æ—¥)', 30: 'ç›¸å¯¹å¼ºåº¦(60æ—¥)',
  31: 'ä»·æ ¼å˜åŒ–ç‡(5æ—¥)', 32: 'ä»·æ ¼å˜åŒ–ç‡(10æ—¥)', 33: 'ä»·æ ¼å˜åŒ–ç‡(20æ—¥)', 34: 'ä»·æ ¼å˜åŒ–ç‡(30æ—¥)', 35: 'ä»·æ ¼å˜åŒ–ç‡(60æ—¥)',
  36: 'ç´¯è®¡æ”¶ç›Šç‡(5æ—¥)', 37: 'ç´¯è®¡æ”¶ç›Šç‡(10æ—¥)', 38: 'ç´¯è®¡æ”¶ç›Šç‡(20æ—¥)', 39: 'ç´¯è®¡æ”¶ç›Šç‡(30æ—¥)', 40: 'ç´¯è®¡æ”¶ç›Šç‡(60æ—¥)',
  41: 'ç§»åŠ¨å¹³å‡æ¯”ç‡(5/10)', 42: 'ç§»åŠ¨å¹³å‡æ¯”ç‡(10/20)', 43: 'ç§»åŠ¨å¹³å‡æ¯”ç‡(20/30)', 44: 'ç§»åŠ¨å¹³å‡æ¯”ç‡(5/20)', 45: 'ç§»åŠ¨å¹³å‡æ¯”ç‡(10/30)',
  46: 'ä»·æ ¼åç¦»å‡çº¿(5æ—¥)', 47: 'ä»·æ ¼åç¦»å‡çº¿(10æ—¥)', 48: 'ä»·æ ¼åç¦»å‡çº¿(20æ—¥)', 49: 'ä»·æ ¼åç¦»å‡çº¿(30æ—¥)', 50: 'ä»·æ ¼åç¦»å‡çº¿(60æ—¥)',
  51: 'è¶‹åŠ¿å¼ºåº¦(5æ—¥)', 52: 'è¶‹åŠ¿å¼ºåº¦(10æ—¥)', 53: 'è¶‹åŠ¿å¼ºåº¦(20æ—¥)', 54: 'è¶‹åŠ¿å¼ºåº¦(30æ—¥)', 55: 'è¶‹åŠ¿å¼ºåº¦(60æ—¥)',
  56: 'ä»·æ ¼åŠ é€Ÿåº¦(5æ—¥)', 57: 'ä»·æ ¼åŠ é€Ÿåº¦(10æ—¥)', 58: 'ä»·æ ¼åŠ é€Ÿåº¦(20æ—¥)', 59: 'ä»·æ ¼åŠ é€Ÿåº¦(30æ—¥)', 60: 'ä»·æ ¼åŠ é€Ÿåº¦(60æ—¥)',
  
  // å‡å€¼å›å½’å› å­ (61-100)
  61: 'ä»·æ ¼å›å½’åº¦(5æ—¥)', 62: 'ä»·æ ¼å›å½’åº¦(10æ—¥)', 63: 'ä»·æ ¼å›å½’åº¦(20æ—¥)', 64: 'ä»·æ ¼å›å½’åº¦(30æ—¥)', 65: 'ä»·æ ¼å›å½’åº¦(60æ—¥)',
  66: 'åç¦»åº¦(5æ—¥)', 67: 'åç¦»åº¦(10æ—¥)', 68: 'åç¦»åº¦(20æ—¥)', 69: 'åç¦»åº¦(30æ—¥)', 70: 'åç¦»åº¦(60æ—¥)',
  71: 'Zåˆ†æ•°(5æ—¥)', 72: 'Zåˆ†æ•°(10æ—¥)', 73: 'Zåˆ†æ•°(20æ—¥)', 74: 'Zåˆ†æ•°(30æ—¥)', 75: 'Zåˆ†æ•°(60æ—¥)',
  76: 'ä»·æ ¼ä½ç½®(5æ—¥)', 77: 'ä»·æ ¼ä½ç½®(10æ—¥)', 78: 'ä»·æ ¼ä½ç½®(20æ—¥)', 79: 'ä»·æ ¼ä½ç½®(30æ—¥)', 80: 'ä»·æ ¼ä½ç½®(60æ—¥)',
  81: 'ç›¸å¯¹ä½ç½®(5æ—¥)', 82: 'ç›¸å¯¹ä½ç½®(10æ—¥)', 83: 'ç›¸å¯¹ä½ç½®(20æ—¥)', 84: 'ç›¸å¯¹ä½ç½®(30æ—¥)', 85: 'ç›¸å¯¹ä½ç½®(60æ—¥)',
  86: 'åè½¬ä¿¡å·(5æ—¥)', 87: 'åè½¬ä¿¡å·(10æ—¥)', 88: 'åè½¬ä¿¡å·(20æ—¥)', 89: 'åè½¬ä¿¡å·(30æ—¥)', 90: 'åè½¬ä¿¡å·(60æ—¥)',
  91: 'è¶…ä¹°è¶…å–(5æ—¥)', 92: 'è¶…ä¹°è¶…å–(10æ—¥)', 93: 'è¶…ä¹°è¶…å–(20æ—¥)', 94: 'è¶…ä¹°è¶…å–(30æ—¥)', 95: 'è¶…ä¹°è¶…å–(60æ—¥)',
  96: 'å›å½’ç³»æ•°(5æ—¥)', 97: 'å›å½’ç³»æ•°(10æ—¥)', 98: 'å›å½’ç³»æ•°(20æ—¥)', 99: 'å›å½’ç³»æ•°(30æ—¥)', 100: 'å›å½’ç³»æ•°(60æ—¥)',
  
  // æ³¢åŠ¨ç‡å› å­ (101-140)
  101: 'ä»·æ ¼æ³¢åŠ¨ç‡(5æ—¥)', 102: 'ä»·æ ¼æ³¢åŠ¨ç‡(10æ—¥)', 103: 'ä»·æ ¼æ³¢åŠ¨ç‡(20æ—¥)', 104: 'ä»·æ ¼æ³¢åŠ¨ç‡(30æ—¥)', 105: 'ä»·æ ¼æ³¢åŠ¨ç‡(60æ—¥)',
  106: 'æ”¶ç›Šç‡æ³¢åŠ¨ç‡(5æ—¥)', 107: 'æ”¶ç›Šç‡æ³¢åŠ¨ç‡(10æ—¥)', 108: 'æ”¶ç›Šç‡æ³¢åŠ¨ç‡(20æ—¥)', 109: 'æ”¶ç›Šç‡æ³¢åŠ¨ç‡(30æ—¥)', 110: 'æ”¶ç›Šç‡æ³¢åŠ¨ç‡(60æ—¥)',
  111: 'å†å²æ³¢åŠ¨ç‡(5æ—¥)', 112: 'å†å²æ³¢åŠ¨ç‡(10æ—¥)', 113: 'å†å²æ³¢åŠ¨ç‡(20æ—¥)', 114: 'å†å²æ³¢åŠ¨ç‡(30æ—¥)', 115: 'å†å²æ³¢åŠ¨ç‡(60æ—¥)',
  116: 'æ ‡å‡†å·®(5æ—¥)', 117: 'æ ‡å‡†å·®(10æ—¥)', 118: 'æ ‡å‡†å·®(20æ—¥)', 119: 'æ ‡å‡†å·®(30æ—¥)', 120: 'æ ‡å‡†å·®(60æ—¥)',
  121: 'å˜å¼‚ç³»æ•°(5æ—¥)', 122: 'å˜å¼‚ç³»æ•°(10æ—¥)', 123: 'å˜å¼‚ç³»æ•°(20æ—¥)', 124: 'å˜å¼‚ç³»æ•°(30æ—¥)', 125: 'å˜å¼‚ç³»æ•°(60æ—¥)',
  126: 'æ³¢åŠ¨ç‡æ¯”ç‡(5/10)', 127: 'æ³¢åŠ¨ç‡æ¯”ç‡(10/20)', 128: 'æ³¢åŠ¨ç‡æ¯”ç‡(20/30)', 129: 'æ³¢åŠ¨ç‡æ¯”ç‡(5/20)', 130: 'æ³¢åŠ¨ç‡æ¯”ç‡(10/30)',
  131: 'æ³¢åŠ¨ç‡å˜åŒ–(5æ—¥)', 132: 'æ³¢åŠ¨ç‡å˜åŒ–(10æ—¥)', 133: 'æ³¢åŠ¨ç‡å˜åŒ–(20æ—¥)', 134: 'æ³¢åŠ¨ç‡å˜åŒ–(30æ—¥)', 135: 'æ³¢åŠ¨ç‡å˜åŒ–(60æ—¥)',
  136: 'æ³¢åŠ¨ç‡åŠ é€Ÿåº¦(5æ—¥)', 137: 'æ³¢åŠ¨ç‡åŠ é€Ÿåº¦(10æ—¥)', 138: 'æ³¢åŠ¨ç‡åŠ é€Ÿåº¦(20æ—¥)', 139: 'æ³¢åŠ¨ç‡åŠ é€Ÿåº¦(30æ—¥)', 140: 'æ³¢åŠ¨ç‡åŠ é€Ÿåº¦(60æ—¥)',
  
  // æˆäº¤é‡å› å­ (141-158)
  141: 'æˆäº¤é‡å˜åŒ–ç‡(5æ—¥)', 142: 'æˆäº¤é‡å˜åŒ–ç‡(10æ—¥)', 143: 'æˆäº¤é‡å˜åŒ–ç‡(20æ—¥)', 144: 'æˆäº¤é‡å˜åŒ–ç‡(30æ—¥)', 145: 'æˆäº¤é‡å˜åŒ–ç‡(60æ—¥)',
  146: 'æˆäº¤é‡æ³¢åŠ¨ç‡(5æ—¥)', 147: 'æˆäº¤é‡æ³¢åŠ¨ç‡(10æ—¥)', 148: 'æˆäº¤é‡æ³¢åŠ¨ç‡(20æ—¥)', 149: 'æˆäº¤é‡æ³¢åŠ¨ç‡(30æ—¥)', 150: 'æˆäº¤é‡æ³¢åŠ¨ç‡(60æ—¥)',
  151: 'é‡ä»·ç›¸å…³æ€§(5æ—¥)', 152: 'é‡ä»·ç›¸å…³æ€§(10æ—¥)', 153: 'é‡ä»·ç›¸å…³æ€§(20æ—¥)', 154: 'é‡ä»·ç›¸å…³æ€§(30æ—¥)', 155: 'é‡ä»·ç›¸å…³æ€§(60æ—¥)',
  156: 'æˆäº¤é‡æ¯”ç‡(5/10)', 157: 'æˆäº¤é‡æ¯”ç‡(10/20)', 158: 'æˆäº¤é‡æ¯”ç‡(20/30)',
};

/**
 * æ ¹æ®Alpha158å› å­ç¼–å·è·å–ç±»åˆ«
 * åŸºäºQlib Alpha158å› å­çš„æ ‡å‡†å®šä¹‰è¿›è¡Œå¤§è‡´åˆ†ç±»
 */
function getAlpha158CategoryByNumber(alphaNumber: number): string {
  // æ ¹æ®Alpha158çš„æ ‡å‡†å®šä¹‰ï¼Œå¤§è‡´åˆ†ç±»ï¼š
  // 1-60: åŠ¨é‡ç±»å› å­ï¼ˆä»·æ ¼å˜åŒ–ã€æ”¶ç›Šç‡ç­‰ï¼‰
  // 61-100: å‡å€¼å›å½’ç±»å› å­
  // 101-140: æ³¢åŠ¨ç‡ç±»å› å­
  // 141-158: æˆäº¤é‡ç±»å› å­
  
  if (alphaNumber >= 1 && alphaNumber <= 60) {
    return 'MOMENTUM';
  } else if (alphaNumber >= 61 && alphaNumber <= 100) {
    return 'MEAN_REVERSION';
  } else if (alphaNumber >= 101 && alphaNumber <= 140) {
    return 'VOLATILITY';
  } else if (alphaNumber >= 141 && alphaNumber <= 158) {
    return 'VOLUME';
  }
  return 'OTHER';
}

/**
 * è·å–Alpha158å› å­çš„å®é™…åç§°
 */
function getAlpha158FactorName(alphaNumber: number): string {
  return ALPHA158_FACTOR_NAMES[alphaNumber] || `Alphaå› å­ #${alphaNumber}`;
}

/**
 * è§£æAlphaå› å­åç§°ï¼Œè·å–åˆ†ç±»å’Œå‘¨æœŸä¿¡æ¯
 */
export function parseAlphaFactor(factorName: string): AlphaFactorInfo {
  // é¦–å…ˆå°è¯•åŒ¹é… alpha_XXX æ ¼å¼ï¼ˆæ ‡å‡†Alpha158å› å­ï¼‰
  const alpha158Match = factorName.match(/^alpha_(\d+)$/i);
  if (alpha158Match) {
    const alphaNumber = parseInt(alpha158Match[1], 10);
    const category = getAlpha158CategoryByNumber(alphaNumber);
    const categoryInfo = ALPHA_FACTOR_CATEGORIES[category as keyof typeof ALPHA_FACTOR_CATEGORIES] || ALPHA_FACTOR_CATEGORIES.OTHER;
    const actualName = getAlpha158FactorName(alphaNumber);
    
    return {
      name: factorName,
      category,
      description: actualName,
      formula: `æ ‡å‡†Alpha158å› å­ï¼Œç¼–å·${alphaNumber}ï¼Œå±äº${categoryInfo.name}ç±»åˆ«`,
    };
  }

  // åŒ¹é…å…¶ä»–æ ¼å¼ï¼šRESI5, MA10, STD20, VSTD30, CORR5, MAX10, MIN20, QTLU30ç­‰
  const patterns = [
    { pattern: /^(RESI)(\d+)$/i, category: 'RESI', description: 'ä»·æ ¼æ”¶ç›Šç‡', formula: '(å½“å‰ä»·æ ¼ - Nå¤©å‰ä»·æ ¼) / Nå¤©å‰ä»·æ ¼' },
    { pattern: /^(MA)(\d+)$/i, category: 'MA', description: 'ç§»åŠ¨å¹³å‡', formula: 'è¿‡å»Nå¤©çš„æ”¶ç›˜ä»·å¹³å‡å€¼' },
    { pattern: /^(STD)(\d+)$/i, category: 'STD', description: 'ä»·æ ¼æ³¢åŠ¨ç‡', formula: 'è¿‡å»Nå¤©æ”¶ç›˜ä»·çš„æ ‡å‡†å·®' },
    { pattern: /^(VSTD)(\d+)$/i, category: 'VSTD', description: 'æˆäº¤é‡æ³¢åŠ¨ç‡', formula: 'è¿‡å»Nå¤©æˆäº¤é‡çš„æ ‡å‡†å·®' },
    { pattern: /^(CORR)(\d+)$/i, category: 'CORR', description: 'é‡ä»·ç›¸å…³æ€§', formula: 'è¿‡å»Nå¤©ä»·æ ¼ä¸æˆäº¤é‡çš„ç›¸å…³ç³»æ•°' },
    { pattern: /^(MAX)(\d+)$/i, category: 'MAX', description: 'æœ€é«˜ä»·', formula: 'è¿‡å»Nå¤©æœ€é«˜ä»·çš„æœ€å¤§å€¼' },
    { pattern: /^(MIN)(\d+)$/i, category: 'MIN', description: 'æœ€ä½ä»·', formula: 'è¿‡å»Nå¤©æœ€ä½ä»·çš„æœ€å°å€¼' },
    { pattern: /^(QTLU)(\d+)$/i, category: 'QTLU', description: 'åˆ†ä½æ•°æ¯”ç‡', formula: 'è¿‡å»Nå¤©ä»·æ ¼çš„80åˆ†ä½æ•° / 20åˆ†ä½æ•°' },
  ];

  for (const { pattern, category, description, formula } of patterns) {
    const match = factorName.match(pattern);
    if (match) {
      const period = match[2] ? parseInt(match[2], 10) : undefined;
      return {
        name: factorName,
        category,
        description: period ? `${description} (${period}å¤©)` : description,
        formula,
        period,
      };
    }
  }

  // é»˜è®¤è¿”å›
  return {
    name: factorName,
    category: 'OTHER',
    description: 'Alphaå› å­',
  };
}

/**
 * å°†Alphaå› å­æŒ‰ç±»åˆ«åˆ†ç»„
 */
export function groupAlphaFactorsByCategory(factors: string[]): Record<string, string[]> {
  const grouped: Record<string, string[]> = {};

  factors.forEach((factor) => {
    const info = parseAlphaFactor(factor);
    if (!grouped[info.category]) {
      grouped[info.category] = [];
    }
    grouped[info.category].push(factor);
  });

  // å¯¹æ¯ä¸ªç±»åˆ«å†…çš„å› å­è¿›è¡Œæ’åº
  Object.keys(grouped).forEach((category) => {
    grouped[category].sort((a, b) => {
      // å¦‚æœæ˜¯alpha_XXXæ ¼å¼ï¼ŒæŒ‰ç¼–å·æ’åº
      const alphaMatchA = a.match(/^alpha_(\d+)$/i);
      const alphaMatchB = b.match(/^alpha_(\d+)$/i);
      if (alphaMatchA && alphaMatchB) {
        return parseInt(alphaMatchA[1], 10) - parseInt(alphaMatchB[1], 10);
      }
      
      // å¦‚æœæœ‰å‘¨æœŸï¼ŒæŒ‰å‘¨æœŸæ’åº
      const infoA = parseAlphaFactor(a);
      const infoB = parseAlphaFactor(b);
      if (infoA.period && infoB.period) {
        return infoA.period - infoB.period;
      }
      
      // å¦åˆ™æŒ‰åç§°æ’åº
      return a.localeCompare(b);
    });
  });

  return grouped;
}

/**
 * è·å–Alphaå› å­çš„æ˜¾ç¤ºåç§°
 */
export function getAlphaFactorDisplayName(factorName: string): string {
  // å¦‚æœæ˜¯alpha_XXXæ ¼å¼ï¼Œæ˜¾ç¤ºå®é™…åç§°
  const alpha158Match = factorName.match(/^alpha_(\d+)$/i);
  if (alpha158Match) {
    const alphaNumber = parseInt(alpha158Match[1], 10);
    return getAlpha158FactorName(alphaNumber);
  }
  
  const info = parseAlphaFactor(factorName);
  if (info.period) {
    return `${info.description} (${info.period}å¤©)`;
  }
  return info.description || factorName;
}

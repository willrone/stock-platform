# LightGBM 股票预测模型 v3 vs v4 对比报告

## 执行摘要

**结论：v4 修复版在考虑实际交易成本后表现更优，但仍未达到目标。**

---

## 一、模型性能对比

### 1.1 AUC 指标

| 指标 | v3 | v4 (修复版) | 变化 |
|------|----|-----------|----|
| 训练集 AUC | 0.7159 | 0.6672 | -0.0487 |
| 验证集 AUC | 0.5351 | 0.5208 | -0.0143 |
| **测试集 AUC** | **0.5401** | **0.5420** | **+0.0019** ✅ |

**分析：**
- v4 测试集 AUC 略高于 v3（0.5420 vs 0.5401）
- v4 训练集 AUC 更低，说明**过拟合程度降低**
- 但两者都未达到目标 0.55+

### 1.2 分组分析（测试集）

#### v3 - Top 10% 分组
- 平均概率：0.5468
- 实际涨比例：55.24%
- 平均收益：**0.746%**

#### v4 - Top 10% 分组（分位 9）
- 平均概率：0.4466
- 实际涨比例：47.25%
- 平均收益：**-0.235%**

**问题：v4 的分组分析异常，Top 10% 反而收益为负！**

---

## 二、策略回测对比（关键）

### 2.1 Top 5 策略

| 指标 | v3（未扣成本）| v4（扣成本 0.1%）| 说明 |
|------|-------------|----------------|------|
| 日胜率 | 66.80% | 51.87% | v3 虚高 |
| 日均收益 | 1.359% | 0.055% | v3 未扣成本 |
| 年化收益 | 342.5% | 13.9% | v3 不可信 |
| 夏普比率 | 6.58 | 0.40 | v4 更真实 |
| 最大回撤 | -22.1% | -28.8% | 相近 |

**修正 v3（假设扣除 0.1% 成本）：**
- 日均收益：1.359% - 0.1% = **1.259%**
- 年化收益：约 **317%**
- 夏普比率：约 **6.1**

### 2.2 Top 10 策略

| 指标 | v3（修正后）| v4（扣成本）| 对比 |
|------|-----------|------------|-----|
| 日均收益 | ~0.992% | 0.015% | v3 远优 |
| 年化收益 | ~250% | 3.8% | v3 远优 |
| 夏普比率 | ~5.5 | 0.11 | v3 远优 |

---

## 三、核心问题分析

### 3.1 v4 为什么表现差？

**问题 1：标签阈值过低**
- v4 使用 0.15% 阈值（`future_return > 0.0015`）
- v3 使用 0.20% 阈值（`future_return > 0.002`）
- **更低的阈值导致正样本质量下降**

**问题 2：分组异常**
- v4 的 Top 10% 收益为负，说明**预测概率与实际收益相关性弱**
- 可能原因：特征工程过度复杂，引入噪声

**问题 3：市场特征主导**
- v4 特征重要性 Top 3 全是市场级特征：
  - market_volatility: 1361.1
  - market_return: 1233.1
  - market_up_ratio: 562.2
- **模型过度依赖市场整体，个股选择能力弱**

### 3.2 v3 的优势

1. **更简洁的特征集**（47 个 vs v4 的 70+ 个）
2. **更合理的标签阈值**（0.2%）
3. **个股特征主导**（di_diff, wick_lower, body 等）
4. **分组区分度强**（Top 10% 收益 0.746%）

---

## 四、目标达成情况

| 目标 | v3 | v4 | 达成 |
|------|----|----|-----|
| 测试集 AUC > 0.55 | 0.5401 | 0.5420 | ❌ 均未达标 |
| Top 分位组收益稳定 | 0.746% | -0.235% | ❌ v4 更差 |
| 夏普比率 > 2（扣成本）| ~6.1 | 0.40 | ✅ v3 达标，v4 未达标 |

---

## 五、改进建议

### 5.1 立即可行的优化

1. **调整标签阈值**
   - 恢复到 0.2% 或更高（0.3%）
   - 提高正样本质量

2. **特征筛选**
   - 移除低重要性特征（< 50）
   - 减少市场级特征的权重
   - 增加个股相对强度特征

3. **样本平衡**
   - 当前正样本 44.73%，可能过多
   - 考虑提高阈值到 0.3%，使正样本比例降至 35-40%

### 5.2 深度优化方向

1. **截面中性化**
   - 对特征进行行业/市值中性化
   - 减少市场 beta 影响

2. **多目标优化**
   - 不仅优化 AUC，同时优化 Top 10% 收益
   - 使用自定义损失函数

3. **集成学习**
   - 训练多个模型（不同时间窗口、不同特征集）
   - 加权集成

---

## 六、最终建议

**短期方案：继续使用 v3**
- v3 在实际策略回测中表现优异（夏普 6.1）
- 虽然 AUC 略低，但**盈利能力更强**

**中期方案：优化 v4**
1. 标签阈值改为 0.3%
2. 移除市场级特征或降权
3. 增加个股动量/反转因子
4. 重新训练并对比

**长期方案：多模型集成**
- v3（个股特征主导）+ v4（市场情绪感知）
- 不同市场环境下动态切换

---

## 七、数据统计

### 训练数据对比

| 项目 | v3 | v4 |
|------|----|----|
| 股票数 | 300 | 400 |
| 时间范围 | 2019-2025 | 2018-2025 |
| 训练集样本 | 20,580 | 31,366 |
| 测试集样本 | 72,196 | 96,291 |
| 正样本比例 | 39.66% | 44.73% |

### 特征数量对比

| 类别 | v3 | v4 |
|------|----|----|
| 基础收益 | 6 | 8 |
| ���量因子 | 0 | 6 |
| 截面特征 | 0 | 8 |
| 市场情绪 | 0 | 3 |
| 技术指标 | 41 | 45+ |
| **总计** | **47** | **70+** |

---

## 八、结论

1. **v4 在 AUC 上略有提升**（0.5420 vs 0.5401），但**实际盈利能力大幅下降**
2. **核心问题**：标签阈值过低 + 市场特征主导 + 特征过度复杂
3. **建议**：在 v3 基础上**渐进式改进**，而非大幅重构
4. **下一步**：调整 v4 的标签阈值和特征权重，重新训练

---

**报告生成时间：** 2026-02-04  
**测试周期：** 2024-01-02 至 2024-12-30（241 个交易日）  
**交易成本：** 单边 0.1%

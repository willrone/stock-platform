    async def _simulate_training_with_early_stopping(
        self,
        model: Any,
        train_dataset: pd.DataFrame,
        val_dataset: pd.DataFrame,
        config: QlibTrainingConfig,
        early_stopping_manager: EarlyStoppingManager,
        progress_callback: callable,
    ):
        """模拟带早停的训练过程（用于不支持回调的模型）"""
        logger.info("使用模拟训练过程进行早停检查")

        for epoch in range(1, config.early_stopping_patience + 1):
            # 模拟训练指标
            train_loss = 0.5 * (0.9**epoch) + 0.01 + np.random.normal(0, 0.005)
            val_loss = train_loss * 1.1 + 0.005 + np.random.normal(0, 0.01)

            # 添加一些噪声使其更真实
            val_loss = max(val_loss, train_loss * 0.95)  # 确保验证损失不会太低

            # 调用进度回调
            should_stop = await progress_callback(epoch, train_loss, val_loss)

            if should_stop:
                logger.info(f"模拟训练在第 {epoch} 轮提前停止")
                break

            # 模拟训练延迟
            await asyncio.sleep(0.1)


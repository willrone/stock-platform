    async def _evaluate_model(
        self,
        model: Any,
        train_dataset: pd.DataFrame,
        val_dataset: pd.DataFrame,
        model_id: str = None,
    ) -> Tuple[Dict[str, float], Dict[str, float]]:
        """评估模型性能并计算详细指标"""
        try:
            # 记录数据集信息
            if hasattr(train_dataset, "data") and isinstance(
                train_dataset.data, pd.DataFrame
            ):
                logger.info(
                    f"训练集数据维度: {train_dataset.data.shape}, 列: {list(train_dataset.data.columns[:10]) if len(train_dataset.data.columns) > 0 else 'N/A'}"
                )
            elif isinstance(train_dataset, pd.DataFrame):
                logger.info(
                    f"训练集数据维度: {train_dataset.shape}, 列: {list(train_dataset.columns[:10]) if len(train_dataset.columns) > 0 else 'N/A'}"
                )

            if hasattr(val_dataset, "data") and isinstance(
                val_dataset.data, pd.DataFrame
            ):
                logger.info(
                    f"验证集数据维度: {val_dataset.data.shape}, 列: {list(val_dataset.data.columns[:10]) if len(val_dataset.data.columns) > 0 else 'N/A'}"
                )
            elif isinstance(val_dataset, pd.DataFrame):
                logger.info(
                    f"验证集数据维度: {val_dataset.shape}, 列: {list(val_dataset.columns[:10]) if len(val_dataset.columns) > 0 else 'N/A'}"
                )

            # 训练集预测 - 使用正确的segment
            train_pred = model.predict(train_dataset, segment="train")
            logger.info(
                f"训练集预测结果: 类型={type(train_pred)}, 形状={train_pred.shape if hasattr(train_pred, 'shape') else len(train_pred) if hasattr(train_pred, '__len__') else 'N/A'}"
            )

            # 验证集预测 - 使用正确的segment
            val_pred = model.predict(val_dataset, segment="valid")
            logger.info(
                f"验证集预测结果: 类型={type(val_pred)}, 形状={val_pred.shape if hasattr(val_pred, 'shape') else len(val_pred) if hasattr(val_pred, '__len__') else 'N/A'}"
            )

            # 计算训练集指标（使用真实标签）
            training_metrics = self._calculate_metrics(
                train_dataset, train_pred, "训练集", model_id
            )

            # 计算验证集指标（使用真实标签）
            validation_metrics = self._calculate_metrics(
                val_dataset, val_pred, "验证集", model_id
            )

            logger.info(
                f"模型评估完成 - 训练准确率: {training_metrics.get('accuracy', 0.0):.4f}, 验证准确率: {validation_metrics.get('accuracy', 0.0):.4f}"
            )
            return training_metrics, validation_metrics

        except Exception as e:
            logger.error(f"模型评估失败: {e}", exc_info=True)
            # 返回默认指标
            return self._get_default_metrics(), self._get_default_metrics()


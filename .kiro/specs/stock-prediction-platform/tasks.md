# 实施计划：股票预测平台

## 概述

基于Python后端和React前端的股票预测平台实施计划。采用微服务架构，集成Qlib量化框架，使用Parquet统一数据存储，支持任务式预测管理。

## 任务

- [x] 1. 项目结构和基础设施搭建
  - 创建Python后端项目结构（FastAPI + SQLAlchemy + Qlib）
  - 创建React前端项目结构（TypeScript + Ant Design Pro）
  - 配置开发环境和依赖管理
  - 设置数据目录结构（Parquet文件组织）
  - _需求：所有需求的基础设施_

- [x] 1.1 编写项目基础设施的单元测试
  - 测试项目结构创建
  - 测试依赖安装和配置
  - _需求：基础设施验证_

- [x] 2. 数据服务层实现
  - [x] 2.1 实现Stock_Data_Service核心功能
    - 实现与远端服务（192.168.3.62）的连接和通信
    - 实现本地Parquet文件检查和读取逻辑
    - 实现数据获取和Parquet格式保存
    - _需求：1.1, 1.2, 1.3_

  - [x] 2.2 编写数据获取本地优先策略的属性测试
    - **属性 1: 数据获取本地优先策略**
    - **验证：需求 1.2, 1.3, 7.3**

  - [x] 2.3 实现增量数据更新机制
    - 实现时间范围检查逻辑
    - 实现缺失数据段的识别和获取
    - _需求：1.5_

  - [x] 2.4 编写增量数据更新的属性测试
    - **属性 10: 增量数据更新**
    - **验证：需求 1.5**

  - [x] 2.5 实现数据服务错误处理和降级机制
    - 实现服务不可用时的本地数据回退
    - 实现服务状态监控和记录
    - _需求：1.4_

- [ ] 3. 技术指标计算服务实现
  - [x] 3.1 实现Technical_Indicator_Calculator核心功能
    - 实现移动平均线计算（MA5、MA10、MA20、MA60）
    - 实现RSI、MACD、布林带指标计算
    - 实现输入数据验证和结果结构化
    - _需求：2.1, 2.2, 2.3, 2.4_

  - [x] 3.2 编写技术指标计算完整性的属性测试
    - **属性 2: 技术指标计算完整性**
    - **验证：需求 2.1, 2.2, 2.4**

  - [x] 3.3 实现批量股票指标计算
    - 实现并行计算多只股票的技术指标
    - 优化计算性能和内存使用
    - _需求：2.5_

  - [x] 3.4 编写批量处理能力的属性测试
    - **属性 9: 批量处理能力**
    - **验证：需求 2.5**

- [-] 4. 检查点 - 确保数据和指标服务正常工作
  - 确保所有测试通过，如有问题请询问用户

- [x] 5. 数据库和存储层实现
  - [x] 5.1 设计和创建SQLite数据库结构
    - 创建任务表、结果表、模型元数据表、系统配置表
    - 实现数据库连接和基础CRUD操作
    - _需求：7.2_

  - [x] 5.2 实现Parquet文件管理系统
    - 实现按股票代码和时间范围的目录结构组织
    - 实现Parquet文件的读写和索引
    - _需求：7.1, 7.4_

  - [x] 5.3 编写数据存储格式统一性的属性测试
    - **属性 7: 数据存储格式统一性**
    - **验证：需求 7.1, 7.4**

  - [x] 5.4 实现数据清理和生命周期管理
    - 实现临时文件和日志的定期清理
    - 保留历史任务记录的策略
    - _需求：7.5_

- [x] 6. 任务管理服务实现
  - [x] 6.1 实现任务创建和管理功能
    - 实现任务创建、ID分配和信息保存
    - 实现任务状态管理（待执行、进行中、已完成、失败）
    - 实现任务进度跟踪和更新
    - _需求：4.1, 4.2_

  - [x] 6.2 编写任务生命周期管理的属性测试
    - **属性 5: 任务生命周期管理**
    - **验证：需求 4.1, 4.2, 4.3**

  - [x] 6.3 实现任务结果保存和查询
    - 实现预测结果的详细保存
    - 实现历史任务查询和结果对比
    - _需求：4.3, 4.4, 4.5_

- [x] 7. 机器学习模型训练服务实现
  - [x] 7.1 集成Qlib框架和模型训练管道
    - 配置Qlib环境和数据接口
    - 实现多模态特征集构建（价格序列、技术指标、基本面数据）
    - _需求：3.1_

  - [x] 7.2 实现现代深度学习模型支持
    - 集成Transformer、TimesNet、PatchTST、Informer模型
    - 保留LSTM、XGBoost作为基线模型
    - _需求：3.2_

  - [x] 7.3 实现模型训练和评估系统
    - 实现时间序列交叉验证
    - 实现性能评估（准确率、夏普比率、最大回撤）
    - 实现最佳模型保存和版本管理
    - _需求：3.3, 3.4_

  - [x] 7.4 编写模型训练结果保存的属性测试
    - **属性 4: 模型训练结果保存**
    - **验证：需求 3.3**

  - [x] 7.5 实现高级训练功能
    - 实现模型集成（ensemble）功能
    - 实现在线学习和增量训练
    - _需求：3.5_

- [x] 8. 预测引擎服务实现
  - [x] 8.1 实现核心预测逻辑
    - 集成训练好的模型进行预测
    - 实现多时间维度预测（日内、短期、中期）
    - 实现置信区间和风险评估计算
    - _需求：4.1, 4.2, 4.3_

  - [x] 8.2 集成Vectorbt回测引擎
    - 实现策略回测和性能指标计算
    - 实现交易记录生成和分析
    - _需求：4.4_

- [ ] 9. 检查点 - 确保后端核心服务完整
  - 确保所有测试通过，如有问题请询问用户

- [ ] 10. API网关实现
  - [x] 10.1 实现FastAPI网关和路由
    - 创建所有API端点和路由规则
    - 实现请求验证和响应格式统一
    - _需求：6.1, 6.2, 6.3_

  - [ ] 10.2 编写API处理一致性的属性测试
    - **属性 6: API处理一致性**
    - **验证：需求 6.1, 6.2, 6.3**

  - [ ] 10.3 实现限流和错误处理
    - 实现基本限流策略
    - 实现统一错误处理和日志记录
    - _需求：6.4_

  - [ ] 10.4 生成API文档
    - 使用FastAPI自动生成OpenAPI文档
    - 实现API版本管理
    - _需求：6.5_

- [x] 11. 前端React应用实现
  - [x] 11.1 创建基础前端架构
    - 搭建React + TypeScript + Ant Design Pro项目
    - 配置路由和状态管理（Zustand）
    - 创建基础布局和导航组件
    - _需求：5.1_

  - [x] 11.2 实现任务管理界面
    - 创建任务创建表单（股票选择器、参数配置）
    - 实现任务列表和状态显示
    - 实现实时进度更新（WebSocket）
    - _需求：5.2, 5.3_

  - [x] 11.3 编写前端数据展示完整性的属性测试
    - **属性 8: 前端数据展示完整性**
    - **验证：需求 5.4**

  - [x] 11.4 实现任务结果展示界面
    - 集成TradingView图表组件展示价格走势
    - 使用ECharts展示技术指标和预测结果
    - 创建详细的交易记录和回测指标展示
    - _需求：5.4_

  - [x] 11.5 实现数据管理页面
    - 显示远端数据服务状态
    - 展示本地Parquet文件列表
    - 实现数据同步控制功能
    - _需求：5.5_

- [x] 12. 系统集成和端到端测试
  - [x] 12.1 实现前后端集成
    - 配置API客户端和WebSocket连接
    - 实现错误处理和用户反馈
    - 测试完整的用户工作流程

  - [x] 12.2 编写集成测试
    - 测试完整的预测任务流程
    - 测试数据同步和管理功能
    - 测试错误恢复机制

- [x] 13. 部署和配置
  - [x] 13.1 创建部署配置
    - 创建Docker配置文件
    - 配置环境变量和配置文件
    - 创建启动脚本和服务配置

  - [x] 13.2 实现监控和日志
    - 配置应用日志和错误监控
    - 实现健康检查端点
    - 创建性能监控仪表板

- [x] 14. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 注意事项

- 所有任务都是必需的，确保从一开始就有完整的测试覆盖和高质量代码
- 每个属性测试必须运行最少100次迭代
- 使用智能生成器创建符合金融市场规律的测试数据
- FastAPI提供了优秀的异步性能和自动API文档生成
- 确保与现有的back_test_data_service（192.168.3.62）的兼容性
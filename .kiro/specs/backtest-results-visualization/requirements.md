# 回测结果可视化展示需求文档

## 介绍

当前系统的回测任务完成后，用户只能看到基础任务信息和简单的统计数据，缺少详细的回测结果展示。本需求旨在设计一个完整的回测结果可视化系统，让用户能够深入分析回测表现，包括收益曲线、风险指标、交易记录、持仓分析等关键信息。

## 术语表

- **回测任务 (Backtest_Task)**: 基于历史数据验证交易策略表现的任务
- **收益曲线 (Equity_Curve)**: 显示组合价值随时间变化的图表
- **回撤曲线 (Drawdown_Curve)**: 显示从峰值下跌幅度的图表
- **交易记录 (Trade_History)**: 所有买卖交易的详细记录
- **持仓分析 (Position_Analysis)**: 各股票持仓情况和表现分析
- **风险指标 (Risk_Metrics)**: 夏普比率、最大回撤、波动率等风险度量
- **绩效报告 (Performance_Report)**: 包含所有关键指标的综合报告

## 需求

### 需求 1: 回测结果概览展示

**用户故事:** 作为投资者，我想要查看回测任务的整体表现概览，以便快速了解策略的盈利能力和风险水平。

#### 验收标准

1. WHEN 用户点击查看回测结果 THEN 系统 SHALL 显示回测概览面板，包含总收益率、年化收益率、夏普比率、最大回撤等关键指标
2. WHEN 显示概览指标 THEN 系统 SHALL 使用颜色编码区分正负收益（绿色表示盈利，红色表示亏损）
3. WHEN 概览面板加载 THEN 系统 SHALL 在3秒内完成数据渲染
4. WHEN 指标数值显示 THEN 系统 SHALL 保留适当的小数位数（收益率保留2位，比率保留3位）
5. WHEN 用户悬停在指标上 THEN 系统 SHALL 显示该指标的详细说明和计算方法

### 需求 2: 收益和回撤曲线可视化

**用户故事:** 作为量化分析师，我想要查看详细的收益曲线和回撤曲线图表，以便分析策略在不同时期的表现。

#### 验收标准

1. WHEN 用户查看回测结果 THEN 系统 SHALL 显示交互式的收益曲线图，展示组合价值随时间的变化
2. WHEN 显示收益曲线 THEN 系统 SHALL 同时显示基准收益曲线（如沪深300指数）进行对比
3. WHEN 用户查看回撤分析 THEN 系统 SHALL 显示回撤曲线图，标注最大回撤期间和恢复时间
4. WHEN 图表渲染 THEN 系统 SHALL 支持缩放、平移、数据点悬停显示等交互功能
5. WHEN 用户选择时间范围 THEN 系统 SHALL 动态更新图表显示对应期间的数据

### 需求 3: 交易记录详细展示

**用户故事:** 作为交易员，我想要查看所有交易记录的详细信息，以便分析交易决策的有效性。

#### 验收标准

1. WHEN 用户查看交易记录 THEN 系统 SHALL 显示包含股票代码、买卖方向、数量、价格、时间、手续费、盈亏的完整交易表格
2. WHEN 显示交易表格 THEN 系统 SHALL 支持按股票代码、交易时间、盈亏金额等字段进行排序和筛选
3. WHEN 交易记录超过100条 THEN 系统 SHALL 实现分页显示，每页显示50条记录
4. WHEN 用户点击交易记录 THEN 系统 SHALL 显示该笔交易的详细信息弹窗，包括当时的技术指标和决策依据
5. WHEN 显示盈亏信息 THEN 系统 SHALL 使用颜色区分盈利交易（绿色）和亏损交易（红色）

### 需求 4: 持仓分析和股票表现

**用户故事:** 作为投资组合经理，我想要分析各只股票的持仓情况和表现，以便优化投资组合配置。

#### 验收标准

1. WHEN 用户查看持仓分析 THEN 系统 SHALL 显示各股票的累计收益、持仓天数、交易次数、胜率等统计信息
2. WHEN 显示股票表现 THEN 系统 SHALL 按收益率排序，突出显示表现最好和最差的股票
3. WHEN 用户选择特定股票 THEN 系统 SHALL 显示该股票的详细交易历史和价格走势图
4. WHEN 显示持仓权重 THEN 系统 SHALL 使用饼图或柱状图展示各股票在组合中的权重分布
5. WHEN 分析持仓周转率 THEN 系统 SHALL 计算并显示组合的换手率和平均持仓期

### 需求 5: 风险指标深度分析

**用户故事:** 作为风险管理师，我想要查看详细的风险指标分析，以便评估策略的风险收益特征。

#### 验收标准

1. WHEN 用户查看风险分析 THEN 系统 SHALL 显示夏普比率、索提诺比率、卡玛比率、信息比率等多维度风险指标
2. WHEN 显示波动率分析 THEN 系统 SHALL 计算并展示日收益率、月收益率、年收益率的波动率
3. WHEN 分析回撤特征 THEN 系统 SHALL 显示最大回撤、平均回撤、回撤恢复时间等回撤相关指标
4. WHEN 用户查看收益分布 THEN 系统 SHALL 显示日收益率的直方图和正态性检验结果
5. WHEN 进行风险归因 THEN 系统 SHALL 分析收益的来源（选股、择时、行业配置等）

### 需求 6: 月度和年度绩效分解

**用户故事:** 作为基金经理，我想要查看按月度和年度分解的绩效表现，以便识别策略的季节性特征。

#### 验收标准

1. WHEN 用户查看月度表现 THEN 系统 SHALL 显示每月收益率的热力图，直观展示各月份表现
2. WHEN 显示年度统计 THEN 系统 SHALL 计算每年的收益率、波动率、夏普比率等关键指标
3. WHEN 分析季节性 THEN 系统 SHALL 统计各月份的平均表现，识别策略的季节性模式
4. WHEN 用户查看滚动指标 THEN 系统 SHALL 显示滚动夏普比率、滚动波动率等动态风险指标
5. WHEN 对比基准表现 THEN 系统 SHALL 计算并显示相对基准的超额收益和跟踪误差

### 需求 7: 回测报告导出功能

**用户故事:** 作为研究员，我想要导出完整的回测报告，以便进行进一步分析或向客户展示。

#### 验收标准

1. WHEN 用户点击导出报告 THEN 系统 SHALL 生成包含所有关键图表和数据的PDF报告
2. WHEN 导出Excel数据 THEN 系统 SHALL 提供交易记录、组合历史、绩效指标的Excel文件下载
3. WHEN 生成报告 THEN 系统 SHALL 在30秒内完成报告生成并提供下载链接
4. WHEN 报告包含图表 THEN 系统 SHALL 确保图表在PDF中清晰可读，支持高分辨率输出
5. WHEN 用户自定义报告 THEN 系统 SHALL 允许用户选择要包含的图表和数据表格

### 需求 8: 实时回测进度监控

**用户故事:** 作为系统用户，我想要实时监控回测任务的执行进度，以便了解任务状态和预估完成时间。

#### 验收标准

1. WHEN 回测任务运行中 THEN 系统 SHALL 通过WebSocket实时推送进度更新，包括完成百分比和当前处理日期
2. WHEN 显示进度信息 THEN 系统 SHALL 展示已处理交易日数量、剩余时间估算、当前处理速度
3. WHEN 回测遇到错误 THEN 系统 SHALL 立即通知用户并显示详细错误信息
4. WHEN 任务完成 THEN 系统 SHALL 自动跳转到结果页面并发送完成通知
5. WHEN 用户取消任务 THEN 系统 SHALL 在5秒内停止回测执行并清理相关资源

### 需求 9: 策略参数敏感性分析

**用户故事:** 作为策略开发者，我想要分析策略参数对回测结果的影响，以便优化参数设置。

#### 验收标准

1. WHEN 用户进行参数分析 THEN 系统 SHALL 支持对关键策略参数进行敏感性测试
2. WHEN 显示参数影响 THEN 系统 SHALL 使用热力图展示不同参数组合下的收益率和夏普比率
3. WHEN 参数优化建议 THEN 系统 SHALL 基于历史表现推荐最优参数组合
4. WHEN 进行蒙特卡洛分析 THEN 系统 SHALL 支持对策略进行随机性测试，评估结果的稳定性
5. WHEN 显示参数边界 THEN 系统 SHALL 标识参数的有效范围和风险区域

### 需求 10: 多策略对比分析

**用户故事:** 作为投资决策者，我想要对比不同策略的回测结果，以便选择最优的投资策略。

#### 验收标准

1. WHEN 用户选择多个回测结果 THEN 系统 SHALL 支持最多5个策略的并行对比分析
2. WHEN 显示对比图表 THEN 系统 SHALL 在同一图表中展示多个策略的收益曲线和回撤曲线
3. WHEN 对比关键指标 THEN 系统 SHALL 使用表格形式对比各策略的收益率、风险指标、交易统计
4. WHEN 分析相关性 THEN 系统 SHALL 计算策略间的收益相关性和组合效果
5. WHEN 推荐最优策略 THEN 系统 SHALL 基于风险调整收益为用户推荐最佳策略选择